<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT Assistant</title>
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <h1>GPT Assistant</h1>
    <p>The recognized phrase and share target data will appear below:</p>
    <div>
        <textarea id="result" rows="6" cols="50" placeholder="Results will appear here..."></textarea>
    </div>

    <script>
        // Start voice recognition immediately upon page load
        window.addEventListener('DOMContentLoaded', () => {
            startVoiceRecognition();
            handleShareTargetData();
        });

        // Function to handle voice recognition
        function startVoiceRecognition() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.start();

            recognition.onresult = (event) => {
                const recognizedPhrase = event.results[0][0].transcript;
                appendTextToResult(`Recognized: ${recognizedPhrase}`);
            };

            recognition.onerror = (event) => {
                console.error("Voice recognition error:", event.error);
            };
        }

        // Function to append text to the result box
        function appendTextToResult(text) {
            const resultBox = document.getElementById('result');
            resultBox.value += `${text}\n`;
        }

        // Function to handle data from the share target if available
        function handleShareTargetData() {
            const urlParams = new URLSearchParams(window.location.search);
            const sentText = urlParams.get('text') || urlParams.get('url');
            if (sentText) {
                appendTextToResult(`Received: ${sentText}`);
            }
        }
    </script>
</body>
</html>
